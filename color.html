<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ç¹ªåœ–æç¤ºè©èˆ‡è‰²ç¥¨åˆ†æå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
        .color-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .color-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-200 min-h-screen text-slate-800 p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-2">ğŸ¨ åœ–ç‰‡é¢¨æ ¼åˆ†æèˆ‡è‰²ç¥¨æå–</h1>
            <p class="text-slate-500">ä¸Šå‚³åœ–ç‰‡ï¼Œè‡ªå‹•ç”Ÿæˆ AI ç¹ªåœ–æç¤ºè© (Prompt) èˆ‡å°ˆæ¥­é…è‰²æ–¹æ¡ˆ</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Column: Upload & Preview -->
            <div class="lg:col-span-5 space-y-6">
                
                <!-- Upload Zone -->
                <div id="drop-zone" class="glass-panel rounded-2xl p-8 border-2 border-dashed border-slate-300 hover:border-blue-500 transition-colors cursor-pointer text-center relative group">
                    <input type="file" id="file-input" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    <div class="space-y-4 pointer-events-none">
                        <div class="w-16 h-16 bg-blue-100 text-blue-500 rounded-full flex items-center justify-center mx-auto group-hover:scale-110 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-lg font-medium text-slate-700">é»æ“Šæˆ–æ‹–æ”¾åœ–ç‰‡è‡³æ­¤</p>
                            <p class="text-sm text-slate-400">æ”¯æ´ JPG, PNG, WebP</p>
                        </div>
                    </div>
                </div>

                <!-- Preview Canvas (Hidden logic, Visible Image) -->
                <div id="preview-container" class="hidden rounded-2xl overflow-hidden shadow-lg border border-slate-200 bg-white relative">
                    <img id="preview-img" class="w-full h-auto object-cover" src="" alt="Preview">
                    <canvas id="analysis-canvas" class="hidden"></canvas>
                    <div id="loading-overlay" class="absolute inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center hidden">
                        <div class="flex flex-col items-center">
                            <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"></div>
                            <span class="text-sm text-blue-600 font-medium">AI åˆ†æä¸­...</span>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Right Column: Analysis Results -->
            <div class="lg:col-span-7 space-y-6">
                
                <!-- Placeholder when no image -->
                <div id="empty-state" class="glass-panel rounded-2xl p-12 text-center h-full flex flex-col items-center justify-center text-slate-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                    <p>è«‹ä¸Šå‚³åœ–ç‰‡ä»¥é–‹å§‹åˆ†æ</p>
                </div>

                <!-- Results Container -->
                <div id="results-container" class="hidden space-y-6">
                    
                    <!-- Style Analysis -->
                    <div class="glass-panel rounded-2xl p-6 shadow-sm">
                        <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            é¢¨æ ¼åˆ†æ (Style Analysis)
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white/50 p-4 rounded-xl border border-slate-100">
                                <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider">é¢¨æ ¼åç¨±</span>
                                <div id="style-name" class="text-xl font-bold text-slate-800 mt-1">åˆ†æä¸­...</div>
                            </div>
                            <div class="bg-white/50 p-4 rounded-xl border border-slate-100">
                                <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider">è¦–è¦ºæè¿°</span>
                                <div id="style-desc" class="text-base text-slate-600 mt-1 leading-snug">åˆ†æä¸­...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Color Palette -->
                    <div class="glass-panel rounded-2xl p-6 shadow-sm">
                        <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                            </svg>
                            è‰²ç¥¨ (Color Palette)
                        </h2>
                        
                        <div class="mb-4">
                            <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">ä¸»è‰² (Main Color)</span>
                            <div id="main-color-card" class="color-card h-16 rounded-xl flex items-center px-4 cursor-pointer text-white shadow-sm" onclick="copyColor(this)">
                                <span class="font-mono text-lg font-bold ml-auto opacity-90 drop-shadow-md">#------</span>
                            </div>
                        </div>

                        <div>
                            <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2 block">è¼”åŠ©è‰² (Secondary Colors)</span>
                            <div id="palette-grid" class="grid grid-cols-4 md:grid-cols-4 gap-3">
                                <!-- Generated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Generated Prompt -->
                    <div class="glass-panel rounded-2xl p-6 shadow-sm bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-100">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="text-lg font-bold text-blue-900 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                ç”Ÿæˆæç¤ºè© (Prompt)
                            </h2>
                            <button onclick="copyPrompt()" class="text-xs bg-white border border-blue-200 hover:bg-blue-600 hover:text-white text-blue-600 px-3 py-1.5 rounded-lg transition-colors flex items-center font-medium">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                </svg>
                                è¤‡è£½
                            </button>
                        </div>
                        <div class="relative">
                            <textarea id="prompt-output" readonly class="w-full h-32 bg-white/70 border border-blue-100 rounded-xl p-4 text-sm font-mono text-slate-700 resize-none focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
                        </div>
                        <p class="text-xs text-blue-400 mt-2 text-right">*æ­¤æç¤ºè©åŒ…å«æå–çš„è‰²ç¢¼èˆ‡é¢¨æ ¼é—œéµå­—</p>
                    </div>

                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-5 right-5 bg-slate-800 text-white px-4 py-3 rounded-lg shadow-lg transform translate-y-20 transition-transform duration-300 flex items-center z-50">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span id="toast-msg">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿</span>
        </div>
    </div>

<script>
    // --- Logic for Color Analysis (Simplified K-Means) ---
    const buildPalette = (imgData, colorCount = 9) => {
        const pixels = imgData.data;
        const pixelCount = imgData.width * imgData.height;
        const quality = 10; // å–æ¨£é–“éš”ï¼Œè¶Šå¤§è¶Šå¿«ä½†è¶Šä¸æº–ç¢º
        const colorArray = [];

        // 1. å–æ¨£
        for (let i = 0; i < pixelCount; i += quality) {
            const offset = i * 4;
            const r = pixels[offset];
            const g = pixels[offset + 1];
            const b = pixels[offset + 2];
            const a = pixels[offset + 3];
            
            // å¿½ç•¥é€æ˜æˆ–æ¥è¿‘ç™½/é»‘çš„æ¥µç«¯è‰² (å¯é¸)
            if (a >= 125) {
                if(!((r > 250 && g > 250 && b > 250) || (r < 10 && g < 10 && b < 10))) {
                    colorArray.push({r, g, b});
                }
            }
        }

        // 2. ç°¡å–®é‡åŒ– (Quantization) - å°‡é¡è‰²ç¸®æ¸›åˆ°é¡ä¼¼çš„æ¡¶ä¸­
        // é€™è£¡ç‚ºäº†ç€è¦½å™¨æ•ˆèƒ½ï¼Œä½¿ç”¨ä¸€å€‹ç°¡åŒ–çš„ç›´æ–¹åœ–æ’åºæ³•ä»£æ›¿å®Œæ•´çš„ K-Means
        const colorMap = {};
        
        colorArray.forEach(c => {
            // å°‡é¡è‰²å››æ¨äº”å…¥åˆ°æœ€è¿‘çš„ 24 (æ¸›å°‘è‰²å½©ç©ºé–“)
            const round = (n) => Math.round(n / 24) * 24;
            const key = `${round(c.r)},${round(c.g)},${round(c.b)}`;
            if (!colorMap[key]) {
                colorMap[key] = { r: c.r, g: c.g, b: c.b, count: 0 };
            }
            colorMap[key].count++;
        });

        // 3. æ’åºæ‰¾å‡ºæœ€å¸¸å‡ºç¾çš„é¡è‰²
        const sortedColors = Object.values(colorMap).sort((a, b) => b.count - a.count);

        // 4. å–å‰ N å€‹é¡è‰²ï¼Œä¸¦å˜—è©¦éæ¿¾æ‰å¤ªéç›¸ä¼¼çš„é¡è‰²
        const distinctColors = [];
        const minDistance = 30; // é¡è‰²é–“çš„æœ€å°å·®ç•°

        const colorDistance = (c1, c2) => {
            return Math.sqrt(Math.pow(c1.r - c2.r, 2) + Math.pow(c1.g - c2.g, 2) + Math.pow(c1.b - c2.b, 2));
        };

        for (let c of sortedColors) {
            if (distinctColors.length >= colorCount) break;
            
            let isDistinct = true;
            for (let existing of distinctColors) {
                if (colorDistance(c, existing) < minDistance) {
                    isDistinct = false;
                    break;
                }
            }
            
            if (isDistinct) {
                distinctColors.push(c);
            }
        }

        // å¦‚æœé¡è‰²ä¸è¶³ï¼Œè£œé½Š (è¤‡è£½æœ€å¾Œä¸€å€‹æˆ–ç”¨ç°è‰²)
        while (distinctColors.length < colorCount) {
            distinctColors.push({r: 200, g: 200, b: 200});
        }

        return distinctColors;
    };

    const rgbToHex = (r, g, b) => {
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
    };

    const getLuminance = (r, g, b) => {
        return 0.2126 * r + 0.7152 * g + 0.0722 * b;
    };

    // --- Logic for Heuristic Style Analysis ---
    const analyzeStyle = (colors) => {
        // è¨ˆç®—å¹³å‡äº®åº¦èˆ‡é£½å’Œåº¦
        let totalLum = 0;
        let totalSat = 0;

        colors.forEach(c => {
            totalLum += getLuminance(c.r, c.g, c.b);
            
            // ç°¡å–®é£½å’Œåº¦è¨ˆç®— (Max - Min) / Max
            const max = Math.max(c.r, c.g, c.b);
            const min = Math.min(c.r, c.g, c.b);
            const sat = max === 0 ? 0 : (max - min) / max;
            totalSat += sat;
        });

        const avgLum = totalLum / colors.length; // 0-255
        const avgSat = totalSat / colors.length; // 0-1

        let styleName = "ç¾ä»£é¢¨æ ¼ (Modern)";
        let styleDesc = "å¹³è¡¡çš„è¦–è¦ºæ•ˆæœï¼Œå…·æœ‰æ¸…æ™°çš„ç´°ç¯€ã€‚";
        let keywords = [];

        // ç°¡å–®çš„æ±ºç­–æ¨¹
        if (avgSat > 0.6) {
            if (avgLum < 80) {
                styleName = "è³½åšé¾å…‹ (Cyberpunk) / éœ“è™¹ (Neon)";
                styleDesc = "é«˜é£½å’Œåº¦ä¸”å°æ¯”å¼·çƒˆçš„è‰²å½©ï¼Œå¸¶æœ‰ç§‘æŠ€æ„Ÿèˆ‡å¤œé–“æ°›åœã€‚";
                keywords = ["vibrant colors", "neon lights", "high contrast", "futuristic", "dark atmosphere", "glowing"];
            } else {
                styleName = "æ³¢æ™®è—è¡“ (Pop Art) / é®®è±” (Vivid)";
                styleDesc = "æ˜äº®ä¸”å……æ»¿æ´»åŠ›çš„è‰²å½©ï¼Œå…·æœ‰å¼·çƒˆçš„è¦–è¦ºè¡æ“ŠåŠ›ã€‚";
                keywords = ["vivid colors", "energetic", "bold lines", "pop art style", "colorful", "bright lighting"];
            }
        } else if (avgSat < 0.2) {
            if (avgLum > 200) {
                styleName = "æ¥µç°¡ä¸»ç¾© (Minimalist) / é«˜èª¿ (High Key)";
                styleDesc = "ä¹¾æ·¨ã€æ˜äº®ï¼Œè‰²å½©ä½èª¿ï¼Œå¼·èª¿ç©ºé–“æ„Ÿèˆ‡ç°¡æ½”ã€‚";
                keywords = ["minimalist", "clean background", "soft lighting", "high key", "elegant", "pure"];
            } else if (avgLum < 50) {
                styleName = "é»‘è‰²é›»å½± (Noir) / ä½èª¿ (Low Key)";
                styleDesc = "æ·±æ²‰ã€ç¥ç§˜ï¼Œä¸»è¦ç”±æš—è‰²èª¿çµ„æˆï¼Œå¼·èª¿å…‰å½±å°æ¯”ã€‚";
                keywords = ["low key", "noir", "shadows", "moody", "mysterious", "dark tones"];
            } else {
                styleName = "å–®è‰²èª¿ (Monochromatic) / å¾©å¤ (Vintage)";
                styleDesc = "è‰²å½©çµ±ä¸€ä¸”æŸ”å’Œï¼Œå¸¶æœ‰æ‡·èˆŠæˆ–å·¥æ¥­é¢¨æ ¼çš„è³ªæ„Ÿã€‚";
                keywords = ["desaturated", "vintage", "classic", "nostalgic", "muted tones", "film grain"];
            }
        } else {
            if (avgLum > 180) {
                styleName = "ç²‰å½© (Pastel) / å¤¢å¹» (Dreamy)";
                styleDesc = "æŸ”å’Œçš„è‰²å½©èˆ‡å…‰ç·šï¼Œç‡Ÿé€ å‡ºè¼•é¬†ã€å¤¢å¹»çš„æ°›åœã€‚";
                keywords = ["pastel colors", "soft focus", "dreamy", "gentle", "romantic", "airy"];
            } else {
                styleName = "å¯«å¯¦ä¸»ç¾© (Realistic) / é›»å½±æ„Ÿ (Cinematic)";
                styleDesc = "è‡ªç„¶çš„è‰²å½©å¹³è¡¡ï¼Œæ¥è¿‘çœŸå¯¦ä¸–ç•Œçš„è¦–è¦ºé«”é©—ã€‚";
                keywords = ["cinematic lighting", "realistic texture", "depth of field", "highly detailed", "4k", "balanced colors"];
            }
        }

        return { name: styleName, desc: styleDesc, keywords: keywords };
    };


    // --- UI Logic ---
    const fileInput = document.getElementById('file-input');
    const dropZone = document.getElementById('drop-zone');
    const previewImg = document.getElementById('preview-img');
    const previewContainer = document.getElementById('preview-container');
    const emptyState = document.getElementById('empty-state');
    const resultsContainer = document.getElementById('results-container');
    const canvas = document.getElementById('analysis-canvas');
    const ctx = canvas.getContext('2d');
    const loadingOverlay = document.getElementById('loading-overlay');

    const handleFile = (file) => {
        if (!file || !file.type.startsWith('image/')) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            previewImg.src = e.target.result;
            previewImg.onload = () => {
                // Show UI
                emptyState.classList.add('hidden');
                previewContainer.classList.remove('hidden');
                loadingOverlay.classList.remove('hidden');
                resultsContainer.classList.add('hidden');

                // Start Analysis after a brief UI update (to show loader)
                setTimeout(() => processImage(), 100);
            };
        };
        reader.readAsDataURL(file);
    };

    const processImage = () => {
        // 1. Draw image to canvas for pixel reading
        // Resize to speed up processing (max 500px)
        const scale = Math.min(1, 500 / previewImg.naturalWidth);
        canvas.width = previewImg.naturalWidth * scale;
        canvas.height = previewImg.naturalHeight * scale;
        ctx.drawImage(previewImg, 0, 0, canvas.width, canvas.height);

        const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        
        // 2. Extract Colors (Main + 8 Aux = 9 total)
        const colors = buildPalette(imgData, 9);
        const mainColor = colors[0];
        const auxColors = colors.slice(1);

        // 3. Analyze Style
        const styleInfo = analyzeStyle(colors);

        // 4. Render Results
        renderResults(mainColor, auxColors, styleInfo);

        // Hide Loader
        loadingOverlay.classList.add('hidden');
        resultsContainer.classList.remove('hidden');
    };

    const renderResults = (mainColor, auxColors, styleInfo) => {
        // Style Info
        document.getElementById('style-name').textContent = styleInfo.name;
        document.getElementById('style-desc').textContent = styleInfo.desc;

        // Main Color
        const mainHex = rgbToHex(mainColor.r, mainColor.g, mainColor.b);
        const mainCard = document.getElementById('main-color-card');
        mainCard.style.backgroundColor = mainHex;
        mainCard.querySelector('span').textContent = mainHex;
        mainCard.dataset.color = mainHex; // For copy function
        
        // Decide text color for main card (black or white)
        const lum = getLuminance(mainColor.r, mainColor.g, mainColor.b);
        mainCard.style.color = lum > 150 ? '#1e293b' : '#ffffff';

        // Palette Grid
        const grid = document.getElementById('palette-grid');
        grid.innerHTML = '';
        auxColors.forEach((c, index) => {
            const hex = rgbToHex(c.r, c.g, c.b);
            const div = document.createElement('div');
            div.className = 'color-card h-20 rounded-xl cursor-pointer relative group overflow-hidden';
            div.style.backgroundColor = hex;
            div.onclick = () => copyColor(div);
            div.dataset.color = hex;
            
            const label = document.createElement('span');
            label.className = 'absolute bottom-0 left-0 right-0 bg-black/30 text-white text-xs text-center py-1 backdrop-blur-sm opacity-0 group-hover:opacity-100 transition-opacity font-mono';
            label.textContent = hex;
            
            div.appendChild(label);
            grid.appendChild(div);
        });

        // Generate Prompt
        const colorTags = [mainHex, ...auxColors.map(c => rgbToHex(c.r, c.g, c.b))];
        const prompt = generatePromptText(styleInfo, colorTags);
        document.getElementById('prompt-output').value = prompt;
    };

    const generatePromptText = (style, colors) => {
        // Construct a structured prompt
        const colorPaletteString = `Color Palette: [${colors.join(', ')}]`;
        
        return `/imagine prompt: A high quality image, style of ${style.name}, ${style.desc}, featuring colors ${colors.slice(0, 3).join(' and ')}. \n\nKeywords: ${style.keywords.join(', ')}, masterpiece, best quality, ultra-detailed, 8k resolution. \n\n--palette ${colors.join('-')}`;
    };

    // --- Interaction Listeners ---
    fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
    
    // Drag and Drop
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('border-blue-500', 'bg-blue-50/50');
    });
    
    dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.classList.remove('border-blue-500', 'bg-blue-50/50');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('border-blue-500', 'bg-blue-50/50');
        handleFile(e.dataTransfer.files[0]);
    });

    // Copy Utilities
    // Helper function for safe copying with fallback
    const safeCopy = (text, successMsg) => {
        // Try modern API first (might fail in strict iframes)
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text)
                .then(() => showToast(successMsg))
                .catch(() => fallbackCopy(text, successMsg));
        } else {
            fallbackCopy(text, successMsg);
        }
    };

    const fallbackCopy = (text, successMsg) => {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        
        // Ensure it's not visible but part of DOM
        textArea.style.position = "fixed";
        textArea.style.left = "-9999px";
        textArea.style.top = "0";
        document.body.appendChild(textArea);
        
        textArea.focus();
        textArea.select();
        
        try {
            const successful = document.execCommand('copy');
            if(successful) showToast(successMsg);
            else showToast("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½");
        } catch (err) {
            showToast("ç„¡æ³•è¤‡è£½ï¼Œè«‹æ‰‹å‹•è¤‡è£½");
            console.error('Fallback copy failed', err);
        }
        
        document.body.removeChild(textArea);
    };

    window.copyColor = (element) => {
        const color = element.dataset.color;
        safeCopy(color, `å·²è¤‡è£½è‰²ç¢¼: ${color}`);
    };

    window.copyPrompt = () => {
        const text = document.getElementById('prompt-output').value;
        safeCopy(text, 'å·²è¤‡è£½æç¤ºè©');
    };

    const showToast = (msg) => {
        const toast = document.getElementById('toast');
        const toastMsg = document.getElementById('toast-msg');
        toastMsg.textContent = msg;
        toast.classList.remove('translate-y-20');
        setTimeout(() => {
            toast.classList.add('translate-y-20');
        }, 2000);
    };

</script>
</body>
</html>